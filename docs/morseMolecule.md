# Morse molecule 

<!--[![Morse molecule example video tutorial](https://topology-tool-kit.github.io/img/gallery/morseMolecule.jpg)](https://youtu.be/Rdsfkb6SpK8)-->

<iframe width="100%" height="420"
src="https://www.youtube.com/embed/Rdsfkb6SpK8" frameborder="0"
allowfullscreen></iframe>

## Pipeline description
This example first loads a VTI file on the disk. The VTI file contains three scalar fields namely `Rho`, `log(Rho)`, and `log(s)`. We are interested in topological analysis of the `log(Rho)` scalar field which corresponds to the electron density distribution around a simple molecule. 

The [MorseSmaleComplex](https://topology-tool-kit.github.io/doc/html/classttkMorseSmaleComplex.html) is computed for this scalar field. The reason for computing Morse-Smale complex is that many chemically relevant concepts, for example, covalent bonds can be directly translated to topological structures computed using the Morse-Smale complex. The critical points of this scalar field also have chemical relevance. The maxima correspond to the atom locations and 2-saddles occur along chemical bonds. 

Then the critical points are then converted into spheres using [IcospheresFromPoints](https://topology-tool-kit.github.io/doc/html/classttkIcospheresFromPoints.html). The maxima are selected and highlighted as bigger spheres. 

Then using appropriate filtering, the 1-separatrices corresponding to the covalent bonds are selected. The criteria used is to select the 1-sepatrices which have no critical points on the boundary and for which `SeparatrixType = 2`, that is they connect a 2-saddle to a maximum. Also, [GeometrySmoother](https://topology-tool-kit.github.io/doc/html/classttkGeometrySmoother.html) is used to make the jagged lines generated by the Morse-Smale complex a little smoother. Then, another type of 1-separatrix is extracted which connects a 2-saddle on a covalent bond to its neighbouring 1-saddles on the boundary.

Lastly, 2-separatrices incident on the covalent bonds (of `SeparatrixType = 1`) are extracted which correspond to separating walls between adjacent atoms. Another type (`SeparatrixType = 2`) of separating wall is also extracted.

## ParaView
To reproduce the above screenshot, go to your [ttk-data](https://github.com/topology-tool-kit/ttk-data) directory and enter the following command:
``` bash
paraview --state=states/morseMolecule.pvsm
```

## Python code

``` python  linenums="1"
--8<-- "python/morseMolecule.py"
```

To run the above Python script, go to your [ttk-data](https://github.com/topology-tool-kit/ttk-data) directory and enter the following command:
``` bash
pvpython python/morseMolecule.py
```


## Inputs
- [BuiltInExample2.vti](https://github.com/topology-tool-kit/ttk-data/raw/dev/BuiltInExample2.vti): 3D scalar field corresponding to electron density distribution around a simple molecule.

## Outputs
- `CriticalPoints.vtp`: All the output critical points in VTK file format (small spheres in the above screenshot). 
- `Maxima.vtu`: The computed maxima which also correspond to atom locations in VTK file format (bigger green spheres).
- `CovalentBonds.vtp`: Selected 1-separatrices corresponding to the covalent bonds in the molecule (the thick white tubes)
- `Selected2saddle1saddleConnectors.vtp`: Geometry of selected separatrices connecting a 2-saddle on a covalent bond to its neighbouring 1-saddles (the dark grey tubes in the screenshot above). 
- `CovalentBondSeparatrixWalls.vtp`: Surface corresponding to 2-separatrices (walls) incident on the covalent bonds (the translucent blue surfaces in the above screenshot)
- `SelectedType2SeparatrixWall.vtu`: Surface corresponding to another type of wall (the green surface).

Note that you are free to change the VTK file extensions to that of any other supported file format (e.g. `csv`) in the above python script.


## C++/Python API
[GeometrySmoother](https://topology-tool-kit.github.io/doc/html/classttkGeometrySmoother.html)

[IcospheresFromPoints](https://topology-tool-kit.github.io/doc/html/classttkIcospheresFromPoints.html)

[MorseSmaleComplex](https://topology-tool-kit.github.io/doc/html/classttkMorseSmaleComplex.html)


